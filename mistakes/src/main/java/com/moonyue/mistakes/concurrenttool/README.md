## 线程安全问题
#### threadlocal
线程池会重用固定的几个线程，一旦线程重用，那么很有可能从首次threadlocal获取值是之前其它用户的请求遗留值。这时threadlocal中的用户信息就其它用户的信息。
- 并不能认为没有显示开启多线程就不会有线程安全问题
- 使用用类似threadlocal工具来存放一些数据时，需要特别注意在代码运行完后，显式地清空设置的数据。
#### concurrenthashmapmisuse
ConcurrentHashMap只能保证原子性的读写线程是安全的
- 不代表多个线程之间的操作状态是一致的，是没有其他线程在操作它的，如果需要确保一致需要手动加锁
- size、isEmpty和containsValue等聚合方法，在并发情况下可能会反应中间状态。因此，在并发状态下这些方法的返回传值只能做为参考，而不能用于流程控制。
- 诸如putAll这样的聚合也不能保证原子性，在putAll的过程中去获取数据可能会取到部分数据。

